<html> 
    <script src="node_modules/three/build/three.min.js"></script>
    <script src="node_modules/three/examples/js/controls/OrbitControls.js"></script>
    <script src="node_modules/three/examples/js/loaders/BVHLoader.js"></script>
</html>
<script id="vertex" type="x-shader/x-fragment">  
    void main() {  
        vec4 pos = vec4(position, 1.0);
        gl_Position = projectionMatrix * modelViewMatrix * pos ;
    }
</script>
    
<script id="fragment" type="x-shader/x-fragment">  
    uniform vec2 u_resolution;
    void main() {  
        vec2 st = gl_FragCoord.xy/u_resolution.xy;

        vec3 color1 = vec3(1.9,0.55,0);
        vec3 color2 = vec3(0.226,0.000,0.615);
      
        float mixValue = distance(st,vec2(0,1));
        vec3 color = mix(color1,color2,mixValue);
      
        gl_FragColor = vec4(color,mixValue);
    }
</script>  

<script id="headvertex" type="x-shader/x-fragment"> 
    void main() {  
        vec4 pos = vec4(position, 1.0);
        gl_Position = projectionMatrix * modelViewMatrix * pos ;
    }
</script>

<script id="headfragment" type="x-shader/x-fragment">  
    uniform vec2 u_resolution;
    void main() {  
        vec2 st = gl_FragCoord.xy/u_resolution.xy;

        vec3 color1 = vec3(0.0,0.55,1.0);
        vec3 color2 = vec3(0.226,1.0,0.615);
      
        float mixValue = distance(st,vec2(0,1));
        vec3 color = mix(color1,color2,mixValue);
      
        gl_FragColor = vec4(color,mixValue);
    }
</script>  

<script>
    //starter code from https://github.com/mrdoob/three.js/blob/master/examples/webgl_loader_bvh.html
    var clock = new THREE.Clock();
    var camera, controls, scene, renderer;
    var mixer, skeletonHelper, boneContainer;
    var cube;
    init();
    animate();
    var uniforms = {u_resolution: { type: "v2", value: new THREE.Vector2() }};
    var material = new THREE.ShaderMaterial( {  
        uniforms: uniforms,
        vertexShader: document.getElementById("vertex").textContent,
        fragmentShader: document.getElementById("fragment").textContent,
    });
    uniforms.u_resolution.value.x = renderer.domElement.width;
    uniforms.u_resolution.value.y = renderer.domElement.height;


    var loader = new THREE.BVHLoader();
    loader.load( "models/pirouette.bvh", function( result ) {
        skeletonHelper = new THREE.SkeletonHelper( result.skeleton.bones[ 0 ] );
        skeletonHelper.skeleton = result.skeleton; // allow animation mixer to bind to SkeletonHelper directly
        boneContainer = new THREE.Group();

        boneContainer.add( result.skeleton.bones[ 0 ] );
        console.log(skeletonHelper); 
        console.log(boneContainer); 
        var geometry = new THREE.BoxGeometry( 10, 10, 10 );
        var material2 = new THREE.MeshBasicMaterial( {color: 0x00ff00} );
        var head = new THREE.Mesh( new THREE.SphereGeometry( 10, 10, 10 ), new THREE.ShaderMaterial( {  
            uniforms: uniforms,
            vertexShader: document.getElementById("headvertex").textContent,
            fragmentShader: document.getElementById("headfragment").textContent,
        }));
        var lhand = new THREE.Mesh( geometry, material );
        var rhand = new THREE.Mesh( geometry, material );
        var lfoot = new THREE.Mesh( geometry, material );
        var rfoot = new THREE.Mesh( geometry, material );
        var torso = new THREE.Mesh(  new THREE.ConeGeometry( 30, 60, 10 ), material );

        skeletonHelper.skeleton.bones[4].add(head); 
        skeletonHelper.skeleton.bones[12].add(rhand); 
        skeletonHelper.skeleton.bones[31].add(lhand); 
        skeletonHelper.skeleton.bones[50].add(rfoot); 
        skeletonHelper.skeleton.bones[55].add(lfoot); 
        skeletonHelper.skeleton.bones[1].add(torso); 

        // for(var i=0; i<57; i++)
        //     skeletonHelper.skeleton.bones[i].add(new THREE.Mesh( geometry, material));
        scene.add( skeletonHelper );
        scene.add( boneContainer );
        // play animation
        skeletonHelper.material = new THREE.MeshBasicMaterial({
            color:"white", 
            transparent:"true", 
            opacity:"0.1"}); 
        mixer = new THREE.AnimationMixer( skeletonHelper );
        mixer.clipAction( result.clip ).setEffectiveWeight( 1.0 ).play();
    } );
    function init() {
        camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, .1, 1000 );
        camera.position.set( 0, 200, 400 );
        controls = new THREE.OrbitControls( camera );
        controls.minDistance = 300;
        controls.maxDistance = 700;
        scene = new THREE.Scene();
        scene.add( new THREE.GridHelper( 400, 10 ) );
        // renderer
        renderer = new THREE.WebGLRenderer( { antialias: true } );
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        document.body.appendChild( renderer.domElement );
        window.addEventListener( 'resize', onWindowResize, false );
    }
    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize( window.innerWidth, window.innerHeight );
    }
    function animate() {
        requestAnimationFrame( animate );
        var delta = clock.getDelta();
        if ( mixer ) mixer.update( delta );
        renderer.render( scene, camera );
    }
</script>